<div class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white animate-fade-in p-4 lg:p-6">
  <!-- Page Header -->
  <div class="mb-4 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <a routerLink="/super-admin" class="text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 font-medium text-xs">
        ← Back
      </a>
      <h1 class="text-xl font-bold text-gray-900 dark:text-white">⚙️ Settings</h1>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading() && activeTab() !== 'profile'" class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-12 flex items-center justify-center">
    <div class="flex flex-col items-center gap-4">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
      <p class="text-gray-600 dark:text-gray-400">Loading settings...</p>
    </div>
  </div>

  <ng-container *ngIf="!loading() || activeTab() === 'profile'">

  <!-- Tabs -->
  <div class="flex gap-1 mb-6 border-b border-gray-200 dark:border-gray-700 overflow-x-auto">
    <button
      (click)="setActiveTab('profile')"
      [class.active]="activeTab() === 'profile'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'profile' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      👤 Profile
    </button>
    <button
      (click)="setActiveTab('general')"
      [class.active]="activeTab() === 'general'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'general' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      ⚙️ General
    </button>
    <button
      (click)="setActiveTab('security')"
      [class.active]="activeTab() === 'security'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'security' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      🔒 Security
    </button>
    <button
      (click)="setActiveTab('email')"
      [class.active]="activeTab() === 'email'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'email' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      ✉️ Email
    </button>
    <button
      (click)="setActiveTab('features')"
      [class.active]="activeTab() === 'features'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'features' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      🎯 Features
    </button>
    <button
      (click)="setActiveTab('menus')"
      [class.active]="activeTab() === 'menus'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'menus' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      📋 Menus
    </button>
    <button
      (click)="setActiveTab('roles')"
      [class.active]="activeTab() === 'roles'"
      class="px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap"
      [ngClass]="activeTab() === 'roles' ? 'text-purple-600 dark:text-purple-400 border-purple-600 dark:border-purple-400' : 'text-gray-600 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300'">
      👥 Roles & Menus
    </button>
  </div>

  <!-- Profile Tab -->
  <div *ngIf="activeTab() === 'profile'" class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
    <app-profile-settings></app-profile-settings>
  </div>

  <form [formGroup]="settingsForm">
    <!-- General Settings -->
    <div *ngIf="activeTab() === 'general'" class="space-y-4">
      <div class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <h2 class="text-sm font-bold text-gray-900 dark:text-white mb-3">General Settings</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <!-- Platform Name -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Platform Name</label>
            <input
              type="text"
              formControlName="platformName"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="Enter platform name"
            />
          </div>

          <!-- Platform URL -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Platform URL</label>
            <input
              type="url"
              formControlName="platformUrl"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="https://example.com"
            />
          </div>

          <!-- Support Email -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Support Email</label>
            <input
              type="email"
              formControlName="supportEmail"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="support@example.com"
            />
          </div>

          <!-- Timezone -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Timezone</label>
            <select formControlName="timezone" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white focus:border-purple-500 focus:outline-none">
              <option value="UTC">UTC</option>
              <option value="EST">EST</option>
              <option value="CST">CST</option>
              <option value="PST">PST</option>
            </select>
          </div>

          <!-- Currency -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Currency</label>
            <select formControlName="currency" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white focus:border-purple-500 focus:outline-none">
              <option value="USD">USD - US Dollar</option>
              <option value="EUR">EUR - Euro</option>
              <option value="GBP">GBP - British Pound</option>
              <option value="INR">INR - Indian Rupee</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Email Settings -->
    <div *ngIf="activeTab() === 'email'" class="space-y-4">
      <div class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <h2 class="text-sm font-bold text-gray-900 dark:text-white mb-3">Email Configuration</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <!-- SMTP Host -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">SMTP Host</label>
            <input
              type="text"
              formControlName="smtpHost"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="smtp.gmail.com"
            />
          </div>

          <!-- SMTP Port -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">SMTP Port</label>
            <input
              type="number"
              formControlName="smtpPort"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="587"
            />
          </div>

          <!-- Sender Email -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Sender Email</label>
            <input
              type="email"
              formControlName="senderEmail"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="noreply@example.com"
            />
          </div>

          <!-- Sender Name -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Sender Name</label>
            <input
              type="text"
              formControlName="senderName"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              placeholder="Exits LMS"
            />
          </div>
        </div>

        <button type="button" (click)="testEmailConnection()" [disabled]="testingEmail()" class="mt-4 px-3 py-2 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 text-white text-xs font-medium rounded-lg transition">
          {{ testingEmail() ? '⏳ Testing...' : '🧪 Test Connection' }}
        </button>
        <p *ngIf="emailTestMessage()" [class.text-green-600]="emailTestMessage().startsWith('✓')" [class.dark:text-green-400]="emailTestMessage().startsWith('✓')" [class.text-red-600]="emailTestMessage().startsWith('✗')" [class.dark:text-red-400]="emailTestMessage().startsWith('✗')" class="text-xs font-medium mt-2">{{ emailTestMessage() }}</p>
      </div>
    </div>

    <!-- Security Settings -->
    <div *ngIf="activeTab() === 'security'" class="space-y-4">
      <div class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <h2 class="text-sm font-bold text-gray-900 dark:text-white mb-3">Security Settings</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <!-- Password Min Length -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Minimum Password Length</label>
            <input
              type="number"
              formControlName="passwordMinLength"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              min="6"
              max="32"
            />
          </div>

          <!-- Session Timeout -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Session Timeout (minutes)</label>
            <input
              type="number"
              formControlName="sessionTimeout"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              min="5"
              max="480"
            />
          </div>

          <!-- Login Attempts -->
          <div>
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Max Login Attempts</label>
            <input
              type="number"
              formControlName="loginAttempts"
              class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none"
              min="3"
              max="20"
            />
          </div>
        </div>

        <!-- Toggles -->
        <div class="space-y-2 mt-4">
          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg">
            <div>
              <p class="text-sm text-gray-900 dark:text-white font-medium">Two-Factor Authentication</p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Require 2FA for admin accounts</p>
            </div>
            <input
              type="checkbox"
              formControlName="enableTwoFactor"
              class="w-4 h-4 rounded cursor-pointer"
            />
          </div>

          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg">
            <div>
              <p class="text-sm text-gray-900 dark:text-white font-medium">API Keys</p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Enable API access for integrations</p>
            </div>
            <input
              type="checkbox"
              formControlName="enableApiKeys"
              class="w-4 h-4 rounded cursor-pointer"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Features -->
    <div *ngIf="activeTab() === 'features'" class="space-y-4">
      <div class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <h2 class="text-sm font-bold text-gray-900 dark:text-white mb-3">Feature Management</h2>

        <div class="space-y-2">
          <!-- Money Loan -->
          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg">
            <div>
              <p class="text-sm text-gray-900 dark:text-white font-medium">💰 Money-Loan Module</p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Allow tenants to use money-loan features</p>
            </div>
            <button
              type="button"
              (click)="toggleFeature('moneyLoan')"
              [class.bg-green-600]="features().moneyLoan"
              [class.bg-gray-400]="!features().moneyLoan"
              class="w-11 h-6 rounded-full transition-colors relative flex-shrink-0"
            >
              <div [class.translate-x-5]="features().moneyLoan" [class.translate-x-0]="!features().moneyLoan" class="w-5 h-5 bg-white rounded-full transition-transform absolute top-0.5 left-0.5"></div>
            </button>
          </div>

          <!-- BNPL -->
          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg">
            <div>
              <p class="text-sm text-gray-900 dark:text-white font-medium">🛒 BNPL Module</p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Allow tenants to use BNPL features</p>
            </div>
            <button
              type="button"
              (click)="toggleFeature('bnpl')"
              [class.bg-green-600]="features().bnpl"
              [class.bg-gray-400]="!features().bnpl"
              class="w-11 h-6 rounded-full transition-colors relative flex-shrink-0"
            >
              <div [class.translate-x-5]="features().bnpl" [class.translate-x-0]="!features().bnpl" class="w-5 h-5 bg-white rounded-full transition-transform absolute top-0.5 left-0.5"></div>
            </button>
          </div>

          <!-- Advanced Analytics -->
          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg">
            <div>
              <p class="text-sm text-gray-900 dark:text-white font-medium">📊 Advanced Analytics</p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Enable advanced reporting and insights</p>
            </div>
            <button
              type="button"
              (click)="toggleFeature('advancedAnalytics')"
              [class.bg-green-600]="features().advancedAnalytics"
              [class.bg-gray-400]="!features().advancedAnalytics"
              class="w-11 h-6 rounded-full transition-colors relative flex-shrink-0"
            >
              <div [class.translate-x-5]="features().advancedAnalytics" [class.translate-x-0]="!features().advancedAnalytics" class="w-5 h-5 bg-white rounded-full transition-transform absolute top-0.5 left-0.5"></div>
            </button>
          </div>

          <!-- Custom Branding -->
          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg">
            <div>
              <p class="text-sm text-gray-900 dark:text-white font-medium">🎨 Custom Branding</p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Allow tenants to customize branding</p>
            </div>
            <button
              type="button"
              (click)="toggleFeature('customBranding')"
              [class.bg-green-600]="features().customBranding"
              [class.bg-gray-400]="!features().customBranding"
              class="w-11 h-6 rounded-full transition-colors relative flex-shrink-0"
            >
              <div [class.translate-x-5]="features().customBranding" [class.translate-x-0]="!features().customBranding" class="w-5 h-5 bg-white rounded-full transition-transform absolute top-0.5 left-0.5"></div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Menu Management Tab -->
  <div *ngIf="activeTab() === 'menus'">
    <app-menu-management></app-menu-management>
  </div>

  <!-- Roles & Permissions Tab -->
  <div *ngIf="activeTab() === 'roles'">
    <app-permission-matrix></app-permission-matrix>
  </div>

  <!-- Save Button -->
  <div *ngIf="activeTab() !== 'menus' && activeTab() !== 'roles' && activeTab() !== 'profile'" class="flex items-center justify-between mt-6 bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 p-4 rounded-lg">
    <div>
      <p class="text-sm text-gray-900 dark:text-white font-medium">Save Changes</p>
      <p class="text-xs text-gray-600 dark:text-gray-400">Click save to apply these settings platform-wide</p>
    </div>
    <div class="flex items-center gap-2">
      <p *ngIf="savedMessage()" [class.text-green-600]="savedMessage().startsWith('✓')" [class.dark:text-green-400]="savedMessage().startsWith('✓')" [class.text-red-600]="savedMessage().startsWith('✗')" [class.dark:text-red-400]="savedMessage().startsWith('✗')" class="text-xs font-medium">{{ savedMessage() }}</p>
      <a routerLink="/super-admin" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white text-xs font-medium rounded-lg transition">
        ← Cancel
      </a>
      <button
        (click)="saveSettings()"
        [disabled]="saving()"
        class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:shadow-lg disabled:opacity-50 text-white text-xs font-semibold rounded-lg transition"
      >
        {{ saving() ? '⏳ Saving...' : '💾 Save' }}
      </button>
    </div>
  </div>
  </ng-container>
</div>
